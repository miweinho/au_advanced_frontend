<form class="transaction-form" [formGroup]="transactionForm" (ngSubmit)="onSubmit()">
  <h3>Add New Transaction</h3>

  <div class="form-row">
    <!-- Card Number -->
    <div class="form-group">
      <label for="cardNumber">Card Number *</label>
      <input
        id="cardNumber"
        type="number"
        formControlName="cardNumber"
        placeholder="Enter 16-digit card number"
        maxlength="16"
        [class.error]="
          transactionForm.get('cardNumber')?.invalid && transactionForm.get('cardNumber')?.touched
        "
        [class.validationg]="transactionForm.get('cardNumber')?.pending"
      />

      @if(transactionForm.get('cardNumber')?.pending) {
      <div class="validation-loading">
        <small>Checking card number...</small>
      </div>
      } @if(transactionForm.get('cardNumber')?.invalid &&
      transactionForm.get('cardNumber')?.touched) {
      <div class="error-messages">
        @if(transactionForm.get('cardNumber')?.errors?.['required']) {
        <small> Card number is required </small>
        } @if (transactionForm.get('cardNumber')?.errors?.['min'] ||
        transactionForm.get('cardNumber')?.errors?.['max']) {
        <small> Card number must be 16 digits </small>
        } @if(transactionForm.get('cardNumber')?.errors?.['cardNotFound']) {
        <small>Card number does not exist</small>
        }
      </div>
      }
    </div>

    <!-- Amount -->
    <div class="form-group">
      <label for="amount">Amount *</label>
      <input
        id="amount"
        type="number"
        step="0.01"
        min="0.01"
        formControlName="amount"
        placeholder="Enter amount"
        [class.error]="
          transactionForm.get('amount')?.invalid && transactionForm.get('amount')?.touched
        "
      />

      @if (transactionForm.get('amount')?.invalid && transactionForm.get('amount')?.touched) {
      <div class="error-messages">
        @if(transactionForm.get('amount')?.errors?.['required']) {
        <small> Amount is required </small>
        }
      </div>
      }
    </div>

    <!-- Currency -->
    <div class="form-group">
      <label for="currencyCode">Currency *</label>
      <select
        id="currencyCode"
        formControlName="currencyCode"
        [class.error]="
          transactionForm.get('currencyCode')?.invalid &&
          transactionForm.get('currencyCode')?.touched
        "
      >
        <option value="">Select Currency</option>
        <option value="MWK">MWK</option>
        <option value="EUR">EUR</option>
        <option value="CAD">CAD</option>
        <option value="USD">USD</option>
        <option value="KYD">KYD</option>
        <option value="NAD">NAD</option>
      </select>

      @if(transactionForm.get('currencyCode')?.invalid &&
      transactionForm.get('currencyCode')?.touched) {
      <div class="error-messages">
        @if(transactionForm.get('currencyCode')?.errors?.['required']) {
        <small> Currency is required </small>
        }
      </div>
      }
    </div>
  </div>

  <div class="form-row">
    <!-- Transaction Date -->
    <div class="form-group">
      <label for="transactionDate">Transaction Date *</label>
      <input
        id="transactionDate"
        type="datetime-local"
        formControlName="transactionDate"
        [class.error]="
          transactionForm.get('transactionDate')?.invalid &&
          transactionForm.get('transactionDate')?.touched
        "
      />

      @if(transactionForm.get('transactionDate')?.invalid &&
      transactionForm.get('transactionDate')?.touched) {
      <div class="error-messages">
        @if(transactionForm.get('transactionDate')?.errors?.['required']) {
        <small> Transaction date is required </small>
        }
      </div>
      }
    </div>

    <!-- Comment -->
    <div class="form-group">
      <label for="comment">Comment *</label>
      <input
        id="comment"
        type="text"
        formControlName="comment"
        placeholder="Enter comment"
        [class.error]="
          transactionForm.get('comment')?.invalid && transactionForm.get('comment')?.touched
        "
      />

      @if(transactionForm.get('comment')?.invalid && transactionForm.get('comment')?.touched) {
      <div class="error-messages">
        @if(transactionForm.get('comment')?.errors?.['required']) {
        <small> Comment is required </small>
        }
      </div>
      }
    </div>
  </div>

  <!-- Form Actions -->
  <div class="form-actions">
    <button type="submit" class="submit-btn" [disabled]="transactionForm.invalid">
      Create Transaction
    </button>

    <button type="button" class="reset-btn" (click)="transactionForm.reset()">Reset</button>

    <button type="button" class="cancel-btn" (click)="cancelled.emit()">Cancel</button>
  </div>

  <!-- Form Status Debug (remove in production) -->
  @if(false) {
  <div class="debug-info">
    <p>Form Valid: {{ transactionForm.valid }}</p>
    <p>Form Value: {{ transactionForm.value | json }}</p>
  </div>
  }
</form>
